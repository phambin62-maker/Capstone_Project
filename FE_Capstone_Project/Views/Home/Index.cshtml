@model FE_Capstone_Project.Models.HomePageViewModel
@{
    var firstname = Context.Session.GetString("FirstName");
    var BASE_API_URL = "https://localhost:7160/api/";
    var BASE_SERVER_URL = "https://localhost:7160";
}
<body class="index-page">
    <main class="main">
        <!-- Travel Hero Section -->
        <section id="travel-hero" class="travel-hero section dark-background">

            <div class="hero-background">
                <video autoplay="" muted="" loop="">
                    <source src="~/assets/img/travel/video-2.mp4" type="video/mp4">
                </video>
                <div class="hero-overlay"></div>
            </div>

            <div class="container position-relative">
                <div class="row align-items-center">
                    <div class="col-lg-7">
                        <div class="hero-text" data-aos="fade-up" data-aos-delay="100">
                            <h1 class="hero-title">Discover Your Perfect Journey</h1>
                            <p class="hero-subtitle">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation.</p>
                            <div class="hero-buttons">
                                <a asp-action="Tours" asp-controller="TourWeb" class="btn btn-primary me-3">Start Exploring</a>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-5">
                        <div class="booking-form-wrapper" data-aos="fade-left" data-aos-delay="200">
                            <div class="booking-form">
                                <h3 class="form-title">Plan Your Adventure</h3>
                                <form asp-action="FilterTourList" asp-controller="TourWeb" method="get">
                                    <div class="form-group mb-3">
                                        <label for="slcDestination">Destination</label>
                                        <select name="slcDestination" id="slcDestination" class="form-select">
                                            <option value="-1">All Destinations</option>
                                            @if (ViewBag.Destinations != null)
                                            {
                                                @foreach (var dest in ViewBag.Destinations)
                                                {
                                                    <option value="@dest.Id">@dest.LocationName</option>
                                                }
                                            }
                                        </select>
                                    </div>

                                    <div class="form-group mb-3">
                                        <label for="slcCategory">Tour Type</label>
                                        <select name="slcCategory" id="slcCategory" class="form-select">
                                            <option value="-1">All Categories</option>
                                            @if (ViewBag.Categories != null)
                                            {
                                                @foreach (var cat in ViewBag.Categories)
                                                {
                                                    <option value="@cat.Id">@cat.CategoryName</option>
                                                }
                                            }
                                        </select>
                                    </div>

                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-group mb-3">
                                                <label for="slcDuration">Duration</label>
                                                <select name="slcDuration" id="slcDuration" class="form-select">
                                                    <option value="">All Durations</option>
                                                    <option value="1-3">1-3 days</option>
                                                    <option value="4-7">4-7 days</option>
                                                    <option value="8-14">8-14 days</option>
                                                    <option value="15+">15+ days</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group mb-3">
                                                <label for="slcPriceRange">Price Range</label>
                                                <select name="slcPriceRange" id="slcPriceRange" class="form-select">
                                                    <option value="">All Prices</option>
                                                    <option value="0-1000000">Under 1,000,000 VND</option>
                                                    <option value="1000000-3000000">1,000,000 - 3,000,000 VND</option>
                                                    <option value="3000000-5000000">3,000,000 - 5,000,000 VND</option>
                                                    <option value="5000000+">Over 5,000,000 VND</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>

                                    <button type="submit" class="btn btn-primary w-100">Find Your Perfect Trip</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </section><!-- /Travel Hero Section -->
        <!-- Latest News Section -->
        <section id="latest-news" class="news-updates section">
            <div class="container section-title" data-aos="fade-up">
                <h2>Latest Travel Stories</h2>
                <div><span>Fresh Insights</span> <span class="description-title">From Our Travel Experts</span></div>
            </div>

            <div class="container" data-aos="fade-up" data-aos-delay="100">
                @if (Model.LatestNews != null && Model.LatestNews.Any())
                {
                    <div class="row g-4">
                        @foreach (var article in Model.LatestNews)
                        {
                            var newsImage = string.IsNullOrEmpty(article.Image)
                            ? Url.Content("~/assets/img/travel/showcase-7.webp")
                            : (article.Image.StartsWith("http", StringComparison.OrdinalIgnoreCase)
                            ? article.Image
                            : $"{BASE_SERVER_URL}{(article.Image.StartsWith("/") ? article.Image : "/" + article.Image)}");

                            <div class="col-lg-4 col-md-6" data-aos="fade-up" data-aos-delay="150">
                                <div class="card h-100 shadow-sm border-0">
                                    <img src="@newsImage" alt="@article.Title" class="card-img-top" style="object-fit: cover; height: 220px;">
                                    <div class="card-body d-flex flex-column gap-2">
                                        <span class="text-muted small">
                                            <i class="bi bi-person-circle me-1"></i>@(article.AuthorName ?? "Travel Desk")
                                            @if (article.CreatedDate.HasValue)
                                            {
                                                <span class="ms-2">
                                                    <i class="bi bi-calendar-event me-1"></i>@article.CreatedDate.Value.ToString("MMM dd, yyyy")
                                                </span>
                                            }
                                        </span>
                                        <h4 class="h5">@article.Title</h4>
                                        <p class="text-muted mb-0">
                                            @{
                                                var snippet = string.IsNullOrWhiteSpace(article.Content)
                                                ? "Stay updated with travel inspirations, guides and tips curated by our team."
                                                : (article.Content.Length > 150 ? article.Content.Substring(0, 150) + "..." : article.Content);
                                            }
                                            @snippet
                                        </p>
                                        <div class="mt-auto">
                                            <!-- Sử dụng class quick-link giống Featured Destinations -->
                                            <a class="quick-link" href="/News/Detail/@article.Id">
                                                Read More <i class="bi bi-chevron-right"></i>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                    <div class="text-center mt-4">
                        <!-- Sử dụng class explore-btn giống Featured Destinations -->
                        <a class="explore-btn" asp-controller="News" asp-action="Index">
                            <span>View All News</span>
                            <i class="bi bi-arrow-right"></i>
                        </a>
                    </div>
                }
                else
                {
                    <div class="alert alert-info text-center">
                        <i class="bi bi-info-circle"></i> No news available at the moment. Please check back later.
                    </div>
                }
            </div>
        </section>

        <!-- Handpicked Tours Section -->
        @if (Model.FeaturedTours != null && Model.FeaturedTours.Any())
        {
            <section id="handpicked-tours" class="handpicked-tours section">
                <div class="container section-title" data-aos="fade-up">
                    <h2>Handpicked Tours</h2>
                    <div><span>Our Favorite</span> <span class="description-title">Experiences Right Now</span></div>
                </div>

                <div class="container" data-aos="fade-up" data-aos-delay="100">
                    <div class="row g-4">
                        @foreach (var tour in Model.FeaturedTours)
                        {
                            var firstImage = tour.TourImages?.FirstOrDefault();
                            var imageUrl = firstImage != null && !string.IsNullOrEmpty(firstImage.Image)
                            ? $"{BASE_API_URL}Tour/GetImage?path={Uri.EscapeDataString(firstImage.Image)}"
                            : Url.Content("~/assets/img/travel/showcase-5.webp");
                            var tourDescription = string.IsNullOrWhiteSpace(tour.Description)
                            ? "Experience unforgettable adventures with our curated itineraries."
                            : (tour.Description.Length > 120 ? tour.Description.Substring(0, 120) + "..." : tour.Description);
                            <div class="col-lg-4 col-md-6" data-aos="fade-up" data-aos-delay="150">
                                <div class="card h-100 shadow-sm border-0 overflow-hidden">
                                    <div class="position-relative">
                                        <img src="@imageUrl" alt="@tour.Name" class="img-fluid w-100" style="object-fit: cover; height: 220px;">
                                        <span class="badge bg-primary position-absolute top-0 end-0 m-3">
                                            <i class="bi bi-clock-history me-1"></i>@tour.Duration day(s)
                                        </span>
                                    </div>
                                    <div class="card-body d-flex flex-column gap-2">
                                        <div class="d-flex justify-content-between align-items-start">
                                            <h4 class="h5">@tour.Name</h4>
                                            <span class="fw-semibold text-primary">@tour.Price.ToString("N0") VND</span>
                                        </div>
                                        <p class="text-muted mb-0">@tourDescription</p>
                                        <div class="d-flex justify-content-between align-items-center pt-2">
                                            <span class="text-secondary small">
                                                <i class="bi bi-geo-alt-fill me-1"></i>@(tour.StartLocation?.LocationName ?? "Flexible")
                                            </span>
                                            <!-- Sử dụng class quick-link giống Featured Destinations -->
                                            <a class="quick-link" href="/TourWeb/TourDetails?tourId=@tour.Id">
                                                View Details <i class="bi bi-chevron-right"></i>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            </section>
        }

        <!-- Featured Destinations Section -->
        <section id="featured-destinations" class="featured-destinations section">

            <!-- Section Title -->
            <div class="container section-title" data-aos="fade-up">
                <h2>Featured Destinations</h2>
                <div><span>Explore</span> <span class="description-title">Amazing Travel Tours</span></div>
            </div><!-- End Section Title -->

            <div class="container" data-aos="fade-up" data-aos-delay="100">

                @if (Model.TourRatings != null && Model.TourRatings.Any())
                {
                    <div class="row">

                        @* Featured tour - Display large on the left *@
                        @if (Model.TourRatings.Count() > 0)
                        {
                            var featuredTour = Model.TourRatings.First();
                            <div class="col-lg-6" data-aos="zoom-in" data-aos-delay="200">
                                <div class="featured-destination">
                                    <div class="destination-overlay">
                                        @{
                                            var imageUrl = $"{BASE_API_URL}Tour/GetImage?path={Uri.EscapeDataString(featuredTour.Image)}";
                                        }
                                        <img src="@imageUrl" alt="@featuredTour.TourName" class="img-fluid">
                                        <div class="destination-info">
                                            <span class="destination-tag">Most Popular</span>
                                            <h3>@featuredTour.TourName</h3>
                                            <p class="description">@featuredTour.Description</p>
                                            <div class="destination-meta">
                                                <div class="rating">
                                                    <i class="bi bi-star-fill"></i>
                                                    <span>@featuredTour.AverageRating.ToString("F1") (@featuredTour.ReviewCount)</span>
                                                </div>
                                            </div>
                                            <div class="price-info">
                                                <span class="starting-from">Starting from</span>
                                                <span class="amount">@featuredTour.Price.ToString("N0") VND</span>
                                            </div>
                                            <!-- Class explore-btn được định nghĩa sẵn trong CSS -->
                                            <a href="/TourWeb/TourDetails?tourId=@featuredTour.TourId" class="explore-btn">
                                                <span>Explore Now</span>
                                                <i class="bi bi-arrow-right"></i>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        }

                        @* Other tours - Display compact on the right *@
                        <div class="col-lg-6">
                            <div class="row g-3">

                                @foreach (var tour in Model.TourRatings.Skip(1).Take(3))
                                {
                                    var delay = 300 + (Model.TourRatings.ToList().IndexOf(tour) * 100);
                                    <div class="col-12" data-aos="fade-left" data-aos-delay="@delay">
                                        <div class="compact-destination">
                                            <div class="destination-image">
                                                @{
                                                    var imageUrl = $"{BASE_API_URL}Tour/GetImage?path={Uri.EscapeDataString(tour.Image)}";
                                                }
                                                <img src="@imageUrl" alt="@tour.TourName" class="img-fluid">
                                                @if (tour.AverageRating >= 4.8m)
                                                {
                                                    <div class="badge-offer">Top Rated</div>
                                                }
                                            </div>
                                            <div class="destination-details">
                                                <h4>@tour.TourName</h4>
                                                <p class="brief">@tour.Description</p>
                                                <div class="stats-row">
                                                    <span class="rating">
                                                        <i class="bi bi-star-fill"></i>
                                                        @tour.AverageRating.ToString("F1")
                                                    </span>
                                                    <span class="price">from @tour.Price.ToString("N0") VND</span>
                                                </div>
                                                <!-- Class quick-link được định nghĩa sẵn trong CSS -->
                                                <a href="/TourWeb/TourDetails?tourId=@tour.TourId" class="quick-link">
                                                    View Details <i class="bi bi-chevron-right"></i>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                }

                            </div>
                        </div>

                    </div>
                }
                else
                {
                    <div class="alert alert-info text-center">
                        <i class="bi bi-info-circle"></i> No tours available at the moment.
                    </div>
                }

            </div>

        </section><!-- /Featured Destinations Section -->
        <!-- Testimonials Home Section -->
        <section id="testimonials-home" class="testimonials-home section">

            <!-- Section Title -->
            <div class="container section-title" data-aos="fade-up">
                <h2>Testimonials</h2>
                <div><span>What Our Customers</span> <span class="description-title">Are Saying</span></div>
            </div><!-- End Section Title -->

            <div class="container" data-aos="fade-up" data-aos-delay="100">

                <div class="swiper init-swiper">
                    <script type="application/json" class="swiper-config">
                        {
                          "loop": true,
                          "speed": 600,
                          "autoplay": {
                            "delay": 5000
                          },
                          "slidesPerView": "auto",
                          "pagination": {
                            "el": ".swiper-pagination",
                            "type": "bullets",
                            "clickable": true
                          },
                          "breakpoints": {
                            "320": {
                              "slidesPerView": 1,
                              "spaceBetween": 40
                            },
                            "1200": {
                              "slidesPerView": 3,
                              "spaceBetween": 1
                            }
                          }
                        }
                    </script>
                    <div class="swiper-wrapper">
                        @foreach (var review in Model.Reviews)
                        {
                            <div class="swiper-slide">
                                <div class="testimonial-item">
                                    <p>
                                        <i class="bi bi-quote quote-icon-left"></i>
                                        <span>@review.Comment</span>
                                        <i class="bi bi-quote quote-icon-right"></i>
                                    </p>
                                    <h3>@review.UserName</h3>
                                    <h4>
                                        @for (int i = 0; i < review.Stars; i++)
                                        {
                                            <i class="bi bi-star-fill"></i>
                                        }
                                        @for (int i = review.Stars; i < 5; i++)
                                        {
                                            <i class="bi bi-star"></i>
                                        }
                                    </h4>
                                </div>
                            </div>
                        }
                    </div>

                    <div class="swiper-pagination"></div>
                </div>

            </div>

        </section><!-- /Testimonials Home Section -->

    </main>

    <!-- Preloader -->
    <div id="preloader"></div>

    <!-- Vendor JS Files -->
    <script src="~/assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="~/assets/vendor/php-email-form/validate.js"></script>
    <script src="~/assets/vendor/aos/aos.js"></script>
    <script src="~/assets/vendor/purecounter/purecounter_vanilla.js"></script>
    <script src="~/assets/vendor/swiper/swiper-bundle.min.js"></script>
    <script src="~/assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
    <script src="~/assets/vendor/imagesloaded/imagesloaded.pkgd.min.js"></script>
    <script src="~/assets/vendor/glightbox/js/glightbox.min.js"></script>

    <!-- Main JS File -->
    <script src="~/assets/js/main.js"></script>

</body>