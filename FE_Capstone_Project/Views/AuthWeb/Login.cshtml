<!DOCTYPE html>
@model FE_Capstone_Project.Models.AuthViewModel
@{
    Layout = null;
    ViewData["Title"] = "Login";
}

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Travel Booking Login</title>
    <link rel="stylesheet" href="~/css/style.css" asp-append-version="true" />

</head>
<body>
    <div class="login-container">
        <div class="login-card">
            <div class="login-header">
                <div class="logo">
                    <svg width="40" height="40" viewBox="0 0 40 40" fill="none">
                        <rect width="40" height="40" rx="12" fill="#0066CC" />
                        <path d="M12 16l8-4 8 4v12l-8 4-8-4V16z" stroke="white" stroke-width="2" fill="none" />
                        <circle cx="20" cy="20" r="3" fill="white" />
                    </svg>
                </div>
                <h1>Welcome back</h1>
                <p>Sign in to continue your journey</p>
            </div>

            <form asp-action="Login" asp-controller="AuthWeb" method="post" class="login-form" novalidate>
                <h2 class="login-title">Sign In</h2>

                <!-- Username -->
                <div class="form-group">
                    <input type="text" id="username" name="UserName" value="@Model.Username" required autocomplete="username" placeholder="Username" class="form-control" />
                    <label for="username">Username</label>
                    <span class="error-message" id="usernameError"></span>
                </div>

                <!-- Password -->
                <div class="form-group">
                    <input type="password" id="password" name="Password" required autocomplete="current-password" placeholder="Password" class="form-control" />
                    <label for="password">Password</label>

                    <button type="button" class="password-toggle" id="passwordToggle" aria-label="Toggle password visibility">
                        <svg class="eye-icon" width="18" height="18" viewBox="0 0 18 18" fill="none">
                            <path d="M9 3C4.5 3 1.05 6.21 0.5 9c.55 2.79 4 6 8.5 6s7.95-3.21 8.5-6c-.55-2.79-4-6-8.5-6zm0 10a4 4 0 110-8 4 4 0 010 8zm0-6.5a2.5 2.5 0 100 5 2.5 2.5 0 000-5z" fill="currentColor" />
                        </svg>
                    </button>

                    <span class="error-message" id="passwordError"></span>
                </div>

                <!-- Options -->
                <div class="form-options">
                    @* <label class="checkbox-wrapper">
                        <input type="checkbox" id="remember" name="remember" />
                        <span class="checkmark">
                            <svg width="12" height="12" viewBox="0 0 12 12" fill="none">
                                <path d="M2 6l2.5 2.5L10 3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                            </svg>
                        </span>
                        Keep me signed in
                    </label> *@
                    @* <a href="#" class="forgot-link">Forgot password?</a> *@
                </div>

                <!-- Submit -->
                <button type="submit" class="login-btn">
                    <span class="btn-text">Sign In</span>
                </button>

                <!-- Message -->
                @if (!string.IsNullOrEmpty(Model.Message))
                {
                    <p id="loginMessage" style="margin-top: 10px; text-align:center; color:red;">@Model.Message</p>
                }
            </form>

            @* <script>
                document.getElementById("loginForm").addEventListener("submit", async function (e) {
                    e.preventDefault();

                    const username = document.getElementById("username").value.trim();
                    const password = document.getElementById("password").value.trim();
                    const messageBox = document.getElementById("loginMessage");
                    const btn = document.querySelector(".login-btn");
                    const btnText = btn.querySelector(".btn-text");
                    const btnLoader = btn.querySelector(".btn-loader");

                    if (!username || !password) {
                        messageBox.textContent = "Vui lòng nhập tên đăng nhập và mật khẩu.";
                        return;
                    }

                    // Hiển thị loading
                    btn.disabled = true;
                    btnText.style.display = "none";
                    btnLoader.style.display = "block";

                    try {
                        const response = await fetch("/auth/login", {
                            method: "POST",
                            headers: { "Content-Type": "application/json" },
                            body: JSON.stringify({ userName: username, password })
                        });

                        const data = await response.json();

                        if (response.ok) {
                            messageBox.style.color = "green";
                            messageBox.textContent = data.message || "Đăng nhập thành công!";
                            localStorage.setItem("jwtToken", data.token);
                            setTimeout(() => {
                                window.location.href = "/Home/Index";
                            }, 1000);
                        } else {
                            messageBox.style.color = "red";
                            messageBox.textContent = data.message || "Sai thông tin đăng nhập.";
                        }
                    } catch (err) {
                        console.error(err);
                        messageBox.style.color = "red";
                        messageBox.textContent = "Lỗi kết nối đến máy chủ.";
                    } finally {
                        // Ẩn loading
                        btn.disabled = false;
                        btnText.style.display = "inline";
                        btnLoader.style.display = "none";
                    }
                });

                // Toggle password visibility
                document.getElementById("passwordToggle").addEventListener("click", () => {
                    const passwordInput = document.getElementById("password");
                    passwordInput.type = passwordInput.type === "password" ? "text" : "password";
                });
            </script> *@


            <div class="divider">
                <span>or sign in with</span>
            </div>

            <div class="social-login">
                <button type="button" class="social-btn">
                    <svg width="20" height="20" viewBox="0 0 20 20">
                        <path fill="#4285F4" d="M18.12 8.89H10.22v2.22h4.54c-.2 1.11-.82 1.64-1.78 2.22v1.78h2.89c1.69-1.56 2.67-3.85 2.67-6.58 0-.58-.05-.71-.17-1.31l.05-.33z" />
                        <path fill="#34A853" d="M10.22 18c2.4 0 4.41-.8 5.88-2.17l-2.89-1.78c-.8.56-1.82.89-2.99.89-2.3 0-4.25-1.55-4.94-3.64H2.17v1.83A8.22 8.22 0 0010.22 18z" />
                        <path fill="#FBBC05" d="M5.28 11.3a4.9 4.9 0 010-3.14V6.33H2.17a8.22 8.22 0 000 7.8l3.11-2.83z" />
                        <path fill="#EA4335" d="M10.22 3.58c1.46 0 2.78.5 3.82 1.5l2.83-2.83A8.22 8.22 0 002.17 6.33l3.11 2.83c.69-2.09 2.64-3.64 4.94-3.58z" />
                    </svg>
                    <a href="@Url.Action("GoogleLogin", "AuthWeb")">Login with Google</a>
                </button>
            </div>

            <div class="signup-link">
                <p>New to TravelFlow? <a href="@Url.Action("Register", "AuthWeb")" ">Create an account</a></p>
            </div>

            <div class="success-message" id="successMessage">
                <div class="success-icon">
                    <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
                        <circle cx="16" cy="16" r="16" fill="#0066CC" />
                        <path d="M11 16l4 4 8-8" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                </div>
                <h3>Welcome back!</h3>
                <p>Taking you to your travel dashboard...</p>
            </div>
        </div>
    </div>

    <script src="~/js/form-untils.js"></script>
    <script src="~/js/script.js"></script>
</body>
</html>