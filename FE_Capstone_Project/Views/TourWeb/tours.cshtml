@model List<TourViewModel>
<body class="tours-page">
    <main class="main">
        <!-- Page Title -->
        <div class="page-title dark-background" data-aos="fade" style="background-image: url(~/assets/img/travel/showcase-8.webp);">
            <div class="container position-relative">
                <h1>Tours</h1>
                <p>Discover our carefully curated tours across Vietnam. From vibrant cities to breathtaking natural landscapes — find your perfect adventure today.</p>
                <nav class="breadcrumbs">
                    <ol>
                        <li><a asp-controller="Home" asp-action="Index">Home</a></li>
                        <li class="current">Tours</li>
                    </ol>
                </nav>
            </div>
        </div><!-- End Page Title -->
        <!-- Travel Tours Section -->
        <section id="travel-tours" class="travel-tours section">

            <div class="container" data-aos="fade-up" data-aos-delay="100">

                <div class="row">
                    <div class="col-lg-8 mx-auto text-center mb-5">
                        <h2>Find Your Perfect Tour</h2>
                        <p>Discover unforgettable travel experiences with our curated collection of tours. Explore by destination, travel style, or date to find the adventure that's perfect for you.</p>
                    </div>
                </div>

                <!-- Featured Tours Slider -->
                <div class="row mb-5" data-aos="fade-up" data-aos-delay="300">
                    <div class="col-12">
                        <h3 class="section-subtitle mb-4">Featured Tours</h3>
                        <div class="featured-tours-slider swiper init-swiper">
                            <script type="application/json" class="swiper-config">
                                {
                                  "loop": true,
                                  "speed": 600,
                                  "autoplay": {
                                    "delay": 5000
                                  },
                                  "slidesPerView": 1,
                                  "spaceBetween": 30,
                                  "pagination": {
                                    "el": ".swiper-pagination",
                                    "type": "bullets",
                                    "clickable": true
                                  },
                                  "breakpoints": {
                                    "768": {
                                      "slidesPerView": 2
                                    },
                                    "1200": {
                                      "slidesPerView": 3
                                    }
                                  }
                                }
                            </script>
                            <div class="swiper-wrapper">
                                @foreach (TourViewModel featuredTour in ViewBag.FeaturedTours)
                                {
                                    <div class="swiper-slide">
                                        <div class="featured-tour-card">
                                            <div class="tour-image">
                                                <img src="@(featuredTour.TourImages != null && featuredTour.TourImages.Any() ? featuredTour.TourImages.First().Image : "/images/default-tour.jpg")"
                                                    class="img-fluid w-100" />
                                                <div class="tour-badge">@featuredTour.Category.CategoryName</div>
                                            </div>
                                            <div class="tour-content">
                                                <h4>@featuredTour.Name</h4>
                                                <p>@featuredTour.Description</p>
                                                <div class="tour-meta">
                                                    <span class="duration"><i class="bi bi-clock"></i> @featuredTour.Duration Day@(featuredTour.Duration == 1 ? "" : "s")</span>
                                                    <span class="price">From @string.Format("{0:N0} VND", featuredTour.Price)</span>
                                                </div>
                                                <a asp-action="TourDetails" asp-route-tourId="@featuredTour.Id" class="btn btn-primary">View Details</a>
                                            </div>
                                        </div>
                                    </div>
                                }
                            </div>
                            <div class="swiper-pagination"></div>
                        </div>
                    </div>
                </div>

                <!-- Tour Filters -->
                <form asp-action="FilterTourList" method="get">
                    <div class="row mb-5" data-aos="fade-up" data-aos-delay="200">
                        <div class="col-12">
                            <div class="tour-filters">
                                <div class="row">
                                    <div class="col-12 mb-3">
                                        <input type="text" name="searchValue" class="form-control" placeholder="Search tours..." value="@(ViewBag.SearchValue ?? "")" onchange="this.form.submit()">
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-3 col-md-6 mb-3">
                                        <select class="form-select" name="slcDestination" onchange="this.form.submit()">
                                            <option value="-1">Select Destination</option>
                                            @foreach (LocationViewModel destination in ViewBag.Destinations)
                                            {
                                                @if (@ViewBag.SelectedDestination != null && destination.Id == (int)ViewBag.SelectedDestination)
                                                {
                                                    <option value="@destination.Id" selected>@destination.LocationName</option>
                                                }
                                                else
                                                {
                                                    <option value="@destination.Id">@destination.LocationName</option>
                                                }
                                            }
                                        </select>
                                    </div>
                                    <div class="col-lg-3 col-md-6 mb-3">
                                        <select class="form-select" name="slcCategory" onchange="this.form.submit()">
                                            <option value="">Tour Type</option>
                                            @foreach (TourCategoryViewModel category in ViewBag.Categories)
                                            {
                                                if(ViewBag.SelectedCategory != null && category.Id == (int)ViewBag.SelectedCategory)
                                                {
                                                    <option value="@category.Id" selected>@category.CategoryName</option>
                                                }
                                                else
                                                {
                                                    <option value="@category.Id">@category.CategoryName</option>
                                                }
                                            }
                                        </select>
                                    </div>
                                    <div class="col-lg-3 col-md-6 mb-3">
                                        @{
                                            List<string> durations = new List<string> { "1-3", "4-7", "8-14", "15+" };
                                        }
                                        <select class="form-select" name="slcDuration" onchange="this.form.submit()">
                                            <option value="">Duration</option>
                                            @foreach (var duration in durations)
                                            {
                                                if(ViewBag.SelectedDuration != null && duration == (string)ViewBag.SelectedDuration)
                                                {
                                                    <option value="@duration" selected>@duration Days</option>
                                                }
                                                else
                                                {
                                                    <option value="@duration">@duration Days</option>
                                                }
                                            }
                                        </select>
                                    </div>
                                    <div class="col-lg-3 col-md-6 mb-3">
                                        @{
                                            List<string> priceRanges = new List<string> { "0-12500000", "12500000-25000000", "25000000-50000000", "50000000+" };
                                        }
                                        <select class="form-select" name="slcPriceRange" onchange="this.form.submit()">
                                            <option value="">Price Range</option>
                                            @foreach (var priceRange in priceRanges)
                                            {
                                                if(ViewBag.SelectedPriceRange != null && priceRange == (string)ViewBag.SelectedPriceRange)
                                                {
                                                    <option value="@priceRange" selected>@priceRange VND</option>
                                                }
                                                else
                                                {
                                                    <option value="@priceRange">@priceRange VND</option>
                                                }
                                            }
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>

                <!-- Tour Grid -->
                <div class="row" data-aos="fade-up" data-aos-delay="600">
                    <div class="col-12">
                        <h3 class="section-subtitle mb-4">All Tours</h3>
                        <div id="tour-list-container">
                            <div class="row">
                                @foreach (var tour in Model)
                                {
                                    string avgRatingText = "N/A";
                                    if (tour.Reviews != null && tour.Reviews.Any())
                                    {
                                        decimal avgRating = (decimal)tour.Reviews.Average(r => r.Stars);
                                        avgRatingText = avgRating.ToString("0.0");
                                    }

                                    <div class="col-lg-4 col-md-6 mb-4">
                                        <div class="tour-card">
                                            <div class="tour-image">
                                                <img src="@(tour.TourImages != null && tour.TourImages.Any() ? tour.TourImages.First().Image : "/images/default-tour.jpg")"
                                                    class="img-fluid w-100" />
                                                <div class="tour-price">@string.Format("{0:N0} VND", tour.Price)</div>
                                            </div>
                                            <div class="tour-content">
                                                <h4>@tour.Name</h4>
                                                <p>@tour.Description</p>
                                                <div class="tour-details">
                                                    <span><i class="bi bi-clock"></i> @tour.Duration Day@(tour.Duration == 1 ? "" : "s")</span>
                                                    <span><i class="bi bi-star-fill"></i> @avgRatingText (@tour.Reviews.Count reviews)</span>
                                                </div>
                                                <a asp-action="TourDetails" asp-route-tourId="@tour.Id" class="btn btn-outline-primary">View Tour</a>
                                            </div>
                                        </div>
                                    </div>
                                }
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Pagination 2 Section -->
                <section id="pagination-2" class="pagination-2 section">

                    <div class="container">
                        <div class="d-flex justify-content-center">
                            <ul class="pagination">
                                <!-- Previous Button -->
                                <li class="@(ViewBag.CurrentPage == 1 ? "disabled" : "")">
                                    <a href="@Url.Action("FilterTourList", new {
                                            searchValue = ViewBag.SearchValue,
                                            slcDestination = ViewBag.SelectedDestination,
                                            slcCategory = ViewBag.SelectedCategory,
                                            slcDuration = ViewBag.SelectedDuration,
                                            slcPriceRange = ViewBag.SelectedPriceRange,
                                            page = ViewBag.CurrentPage - 1
                                        })">
                                        <i class="bi bi-chevron-left"></i>
                                    </a>
                                </li>

                                <!-- Page Numbers -->
                                @for (int i = 1; i <= ViewBag.TotalPages; i++)
                                {
                                    <li>
                                        <a href="@Url.Action("FilterTourList", new {
                                                searchValue = ViewBag.SearchValue,
                                                slcDestination = ViewBag.SelectedDestination,
                                                slcCategory = ViewBag.SelectedCategory,
                                                slcDuration = ViewBag.SelectedDuration,
                                                slcPriceRange = ViewBag.SelectedPriceRange,
                                                page = i
                                            })"
                                        class="@(i == ViewBag.CurrentPage ? "active disabled" : "")">
                                            @i
                                        </a>
                                    </li>
                                }

                                <!-- Next Button -->
                                <li class="@(ViewBag.CurrentPage == ViewBag.TotalPages ? "disabled" : "")">
                                    <a href="@Url.Action("FilterTourList", new {
                                            searchValue = ViewBag.SearchValue,
                                            slcDestination = ViewBag.SelectedDestination,
                                            slcCategory = ViewBag.SelectedCategory,
                                            slcDuration = ViewBag.SelectedDuration,
                                            slcPriceRange = ViewBag.SelectedPriceRange,
                                            page = ViewBag.CurrentPage + 1
                                        })">
                                        <i class="bi bi-chevron-right"></i>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </section><!-- /Pagination 2 Section -->
            </div>

        </section><!-- /Travel Tours Section -->

    </main>

    <!-- Scroll Top -->
    <a href="#" id="scroll-top" class="scroll-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

    <!-- Preloader -->
    <div id="preloader"></div>

    <!-- Vendor JS Files -->
    <script src="~/assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="~/assets/vendor/php-email-form/validate.js"></script>
    <script src="~/assets/vendor/aos/aos.js"></script>
    <script src="~/assets/vendor/purecounter/purecounter_vanilla.js"></script>
    <script src="~/assets/vendor/swiper/swiper-bundle.min.js"></script>
    <script src="~/assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
    <script src="~/assets/vendor/imagesloaded/imagesloaded.pkgd.min.js"></script>
    <script src="~/assets/vendor/glightbox/js/glightbox.min.js"></script>

    <!-- Main JS File -->
    <script src="~/assets/js/main.js"></script>

</body>